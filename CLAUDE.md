# Arabic Legal Platform - ููุตุฉ ุงูุจุญุซ ูู ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ
ููุตุฉ ููุจ ููุจุญุซ ูู ุงูุฃูุธูุฉ ูุงูููุงุฆุญ ุงูุณุนูุฏูุฉ ูุน ุดุฑุญ ุงูููุงุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู.

## ๐๏ธ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

### Frontend
- **React 18** + **TypeScript**
- **Vite** ููู bundling
- **TailwindCSS** ููุชูุณูู
- **shadcn/ui** ูููููุงุช ุงููุงุฌูุฉ
- **Wouter** ููู routing
- **TanStack Query** ูุฅุฏุงุฑุฉ ุงูู state

### Backend
- **Node.js** + **Express 5**
- **Drizzle ORM** + **better-sqlite3** (SQLite)
- **SQLite FTS5** ููุจุญุซ ุงููุงูู (unicode61, remove_diacritics)

### AI Integration
- **OpenAI API** ูุดุฑุญ ุงูููุงุฏ ุงููุงููููุฉ

## ๐ ูููู ุงููุดุฑูุน

```
Arabic-Legal-Platform/
โโโ client/                 # Frontend React
โ   โโโ src/
โ   โ   โโโ components/     # ููููุงุช React
โ   โ   โโโ pages/          # ุงูุตูุญุงุช
โ   โ   โโโ hooks/          # Custom hooks
โ   โ   โโโ lib/            # ููุชุจุงุช ูุณุงุนุฏุฉ
โ   โโโ public/
โ       โโโ data/
โ           โโโ laws/       # ูููุงุช JSON ููุฃูุธูุฉ
โโโ server/                 # Backend Express
โ   โโโ index.ts            # ููุทุฉ ุงูุฏุฎูู
โ   โโโ routes.ts           # API endpoints
โ   โโโ storage.ts          # ุงูุชุนุงูู ูุน ุงููููุงุช
โ   โโโ db.ts               # ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ shared/                 # ููุฏ ูุดุชุฑู
โ   โโโ schema.ts           # Drizzle schema
โ   โโโ routes.ts           # ุชุนุฑูู ุงูู API routes
โโโ script/
    โโโ build.ts            # ุณูุฑุจุช ุงูุจูุงุก
```

## ๐ ุฃูุงูุฑ ุงูุชุดุบูู

```bash
# ุชุซุจูุช ุงููุชุทูุจุงุช
npm install

# ุชุดุบูู ูู ูุถุน ุงูุชุทููุฑ
npm run dev

# ุจูุงุก ููุฅูุชุงุฌ
npm run build

# ุชุดุบูู ุงูุฅูุชุงุฌ
npm start

# ูุญุต TypeScript
npm run check

# ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
npm run db:push
```

## ๐ง ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงููุทููุจุฉ

```env
# ูุงุนุฏุฉ ุงูุจูุงูุงุช
DATABASE_URL=postgresql://user:password@host:5432/database

# OpenAI ููุดุฑุญ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
AI_INTEGRATIONS_OPENAI_API_KEY=sk-...
AI_INTEGRATIONS_OPENAI_BASE_URL=https://api.openai.com/v1

# ุงููุดุฑููู (ุงุฎุชูุงุฑู)
ADMIN_USER_IDS=user_id_1,user_id_2
```

## ๐ ุงูุตูุญุงุช ุงูุฑุฆูุณูุฉ

1. **/** ุฃู **/library** - ุงูููุชุจุฉ ุงููุงููููุฉ (ูุงุฆูุฉ ุงูุฃูุธูุฉ)
2. **/law/:id** - ุชูุงุตูู ุงููุธุงู ูููุงุฏู
3. **/about** - ุนู ุงูููุตุฉ
4. **/admin/reports** - ุชูุงุฑูุฑ ุงูุฃุฎุทุงุก (ูููุดุฑููู)

## ๐ API Endpoints

### ุนุงู
- `GET /api/sources` - ูุตุงุฏุฑ ุงูุฃูุธูุฉ
- `GET /api/library` - ูุงุฆูุฉ ุงูุฃูุธูุฉ
- `GET /api/laws/:id` - ุชูุงุตูู ูุธุงู ูุนูู

### ุงูููุงุฏ
- `GET /api/articles/:lawId/overrides` - ุงูุชุนุฏููุงุช ุนูู ุงูููุงุฏ
- `GET /api/articles/:lawId/:articleNumber` - ูุงุฏุฉ ูุนููุฉ
- `PATCH /api/articles/:lawId/:articleNumber/override` - ุชุนุฏูู ูุงุฏุฉ (ูุดุฑู)
- `DELETE /api/articles/:lawId/:articleNumber/override` - ุญุฐู ุชุนุฏูู (ูุดุฑู)

### ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- `POST /api/explain-article` - ุดุฑุญ ูุงุฏุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู (SSE streaming)

### ุชูุงุฑูุฑ ุงูุฃุฎุทุงุก
- `POST /api/error-reports` - ุฅุฑุณุงู ุชูุฑูุฑ ุฎุทุฃ
- `GET /api/error-reports` - ูุงุฆูุฉ ุงูุชูุงุฑูุฑ (ูุดุฑู)
- `PATCH /api/error-reports/:id/resolve` - ุญู ุชูุฑูุฑ (ูุดุฑู)
- `DELETE /api/error-reports/:id` - ุญุฐู ุชูุฑูุฑ (ูุดุฑู)

## ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช (SQLite + Drizzle)

**ุงูููู:** `data.db` (~5.4 ุฌูุฌุงุจุงูุช) โ SQLite ูุน WAL mode.

### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

```
judgments              โ 568,562 ุญูู ูุถุงุฆู (ุณุนูุฏู + ูุตุฑู)
  โโโ id, case_id, year_hijri, city, court_body, circuit_type
  โโโ judgment_number, judgment_date, text (NOT NULL)
  โโโ principle_text   โ ุงููุจุฏุฃ ุงููุถุงุฆู (ููุฃุญูุงู ุงููุตุฑูุฉุ 332K ุณุฌู)
  โโโ source           โ 'sa_judicial' | 'bog_judicial' | 'eg_naqd'
  โโโ appeal_type, judges (JSON)
  โโโ indexes: source, source+date, date, court_body, year_hijri, city, case_id

judgments_fts          โ FTS5 (text, court_body) โ 568,562 ุณุฌู
law_articles           โ ููุงุฏ ุงูุฃูุธูุฉ (law_id, law_name, article_number, article_text)
law_articles_fts       โ FTS5 ููุจุญุซ ูู ููุงุฏ ุงูุฃูุธูุฉ
gazette_index          โ ููุฑุณ ุงูุฌุฑูุฏุฉ ุงูุฑุณููุฉ (ุฃู ุงููุฑู)
gazette_fts            โ FTS5 ููุจุญุซ ูู ุงูุฌุฑูุฏุฉ
crsd_principles        โ 353 ูุจุฏุฃ ูู ูุฌูุฉ ุงุณุชุฆูุงู ููุงุฒุนุงุช ุงูุฃูุฑุงู ุงููุงููุฉ
crsd_principles_fts    โ FTS5 ููุจุญุซ ูู ูุจุงุฏุฆ CRSD
search_logs            โ ุณุฌู ุนูููุงุช ุงูุจุญุซ
search_clicks          โ ุชุชุจุน ุงูููุฑุงุช ุนูู ูุชุงุฆุฌ ุงูุจุญุซ
article_overrides      โ ุชุนุฏููุงุช ุงูููุงุฏ ูุฏููุงู (ูุดุฑู)
error_reports          โ ุชูุงุฑูุฑ ุงูุฃุฎุทุงุก
```

### ุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉ

| ุงููุตุฏุฑ | ุงูุนุฏุฏ | ุงูุญูู source | ุงูููุงุญุธุงุช |
|--------|-------|--------------|-----------|
| ุฃุญูุงู ุงูููุถ ุงููุตุฑูุฉ (EMJ) | 553,891 | `eg_naqd` | 4 ุฃูุณุงู: ูุฏููุ ุฌูุงุฆูุ ุฏุณุชูุฑูุ ุงูุชุตุงุฏู |
| ุฏููุงู ุงููุธุงูู (BOG) | 6,258 | `bog_judicial` | ูุฌูุฏุงุช 1441-1446 |
| ุงููุถุงุก ุงูุณุนูุฏู | 8,413 | `sa_judicial` | ูู ุจูุงุจุฉ ุงููุถุงุก |
| ูุจุงุฏุฆ CRSD | 353 | ุฌุฏูู ูููุตู | ูุฌูุฉ ุงูุงุณุชุฆูุงู ูู ุงูุฃูุฑุงู ุงููุงููุฉ |

### ุฃุฏุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **Pragmas:** WAL, 64MB cache, 256MB mmap, temp in RAM
- **Indexes:** 7 ุนูู judgments + indexes ููู ุฌุฏูู
- **FTS5 tokenizer:** `unicode61 remove_diacritics 2`
- **Facets cache:** in-memory ูุน TTL ุณุงุนุฉ + pre-warming ุนูุฏ ุจุฏุก ุงูุณูุฑูุฑ
- **ุฃุฏุงุก ูููุฐุฌู:** ูุงุฆูุฉ 0.24sุ facets 0.21s (cached)ุ ุญูู ูุงุญุฏ 3-13ms

### ุณูุฑุจุชุงุช ุงูุจูุงูุงุช

| ุงูุณูุฑุจุช | ุงููุธููุฉ |
|---------|---------|
| `scripts/import_emj_rulings.ts` | ุงุณุชูุฑุงุฏ 562K ุญูู ูุตุฑู ูู `scraper/data/` |
| `scripts/migrate_principles.ts` | ูุตู ุงููุจุฏุฃ ุงููุถุงุฆู ุนู ูุต ุงูุญูู (ูู JSON ุงูุฃุตููุฉ) |
| `scripts/import_crsd_principles.ts` | ุงุณุชูุฑุงุฏ ูุจุงุฏุฆ CRSD |
| `scraper/scraper.js` | ุงุณุชุฎุฑุงุฌ ุฃุญูุงู ุงูููุถ ุงููุตุฑูุฉ ูู EMJ API |
| `scraper/audit_emj_data.js` | ุชุฏููู ุฌูุฏุฉ ุจูุงูุงุช ุงูุฃุญูุงู ุงููุตุฑูุฉ |

### ูููุงุช ุงูุจูุงูุงุช ุงูุฃุตููุฉ (scraper/data/)

```
scraper/data/
โโโ civil_cassation/     โ 95 ููู (1928-2022) โ 266,634 ุญูู
โโโ criminal_cassation/  โ 95 ููู (1928-2022) โ 287,352 ุญูู
โโโ constitutional/      โ 58 ููู (1958-2022) โ 7,133 ุญูู
โโโ economic/            โ 7 ููู (2009-2015) โ 1,185 ุญูู
```

ูู ููู JSON ูุญุชูู ูุตูููุฉ ูู:
```json
{
  "source_id": "878390",
  "section_name": "civil_cassation",
  "case_number": "5921",
  "case_year": "82",
  "session_date": "2020-12-28",
  "principle_text": "ุงููุจุฏุฃ ุงููุถุงุฆู...",
  "facts_text": "ูุต ุงูุญูู ุงููุงูู..."
}
```

## ๐ ุงููุบุฉ ูุงูุงุชุฌุงู
- ุงููุบุฉ ุงูุฃุณุงุณูุฉ: **ุงูุนุฑุจูุฉ**
- ุงุชุฌุงู ุงููุงุฌูุฉ: **RTL** (ูู ุงููููู ูููุณุงุฑ)
- ุงูุฎุท: **Noto Sans Arabic**

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุงุนุฏุฉ ุงูุจูุงูุงุช** SQLite (ููู `data.db` ~5.4GB). ูุง ูุชู ุชุชุจุนู ูู git.
2. **ุงูุจูุงูุงุช ุงููุงููููุฉ** (ุงูุฃูุธูุฉ) ูู `/client/public/data/laws/` ููููุงุช JSON
3. **ุจูุงูุงุช ุงูุฃุญูุงู ุงูุฃุตููุฉ** ูู `scraper/data/` (562K ููู JSON)
4. **ุงููุตุงุฏูุฉ** ุนุจุฑ Google OAuth 2.0 (`server/authSystem.ts`)
5. **ุงูุดุฑุญ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู** ูุณุชุฎุฏู Server-Sent Events ููู streaming
6. **ุงูุฃุญูุงู ุงููุตุฑูุฉ**: `principleText` (ุงููุจุฏุฃ) ูููุตู ุนู `text` (ุงูุญูู) โ ููุนุฑุถุงู ููุณููู ูู ุตูุญุฉ ุงูุชูุงุตูู
7. **ุฃุฏุงุก ุงูุฃุญูุงู**: indexes ุถุฑูุฑูุฉ ุนูู ุฌุฏูู 568K ุตู. ุจุฏูููุง COUNT ูุฃุฎุฐ timeout

## ๐ ูููุดุฑ ุนูู ููุตุงุช ุฃุฎุฑู

### Vercel + Supabase
1. ุบููุฑ ูุธุงู ุงููุตุงุฏูุฉ ูู Replit Auth
2. ุฃุถู DATABASE_URL ูู Supabase
3. ุงูุดุฑ ุงูู Frontend ุนูู Vercel
4. ุงุณุชุฎุฏู Vercel Functions ููู Backend

### Render
1. ุฃูุดุฆ Web Service ููุชุทุจูู ูุงูู
2. ุฃูุดุฆ PostgreSQL database
3. ุฃุถู ูุชุบูุฑุงุช ุงูุจูุฆุฉ

---

## ๐ ุณุฌู ุงูุชุทููุฑ โ ุงุณุชุฎุฑุงุฌ ูุชูุณูู ููุงููู ููุฆุฉ ุงูุฎุจุฑุงุก (BOE)

### ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุงุณุชุฎุฑุงุฌ
- **ุงููุตุฏุฑ**: https://laws.boe.gov.sa/BoeLaws/Laws/Folders/1
- **ุณูุฑุจุช ุงูุงุณุชุฎุฑุงุฌ**: `scripts/extract_folder1_laws.py`
- **ุนุฏุฏ ุงูููุงููู**: 30 ูุงููู (ุชุฌุฑูุจู)
- **ุงููููุงุช**: ุชูุญูุธ ูู `client/public/data/laws/{law_id}_boe.json`
- **ุงูููุงุฑุณ**: `library.json` ู `boe_laws_index.json` ูู `client/public/data/`
- **ุงูุณูุฑูุฑ**: ูุนูู ุนูู ุงููููุฐ **3005** (ูููุณ 5000) โ `npx tsx server/index.ts`

### ุจููุฉ HTML ูู ูููุน ููุฆุฉ ุงูุฎุจุฑุงุก
```
<div class="article_item">           โ ุญุงููุฉ ุงููุงุฏุฉ
  <h3>ุงููุงุฏุฉ ุงูุฎุงูุณุฉ</h3>           โ ุนููุงู ุงููุงุฏุฉ
  <div class="HTMLContainer">        โ ูุต ุงููุงุฏุฉ (ูุฏ ูุญุชูู <br>, <ol>, <li>, <table>, <span>)
  <a class="ancArticlePrevVersions"> โ ุฑุงุจุท ุงูุชุนุฏููุงุช (data-articleid)
  <div class="popup-list">
    <div class="{articleId}">        โ ุญุงููุฉ ุงูุชุนุฏููุงุช
      <div class="article_item_popup"> โ ูู ุชุนุฏูู
        <h3>ุนููุงู ุงูุชุนุฏูู</h3>
        <div class="HTMLContainer">   โ ูุต ุงูุชุนุฏูู (ูุฏ ูุญุชูู ุฌุฏุงูู)
```

---

### ูุดุงูู ุงูุงุณุชุฎุฑุงุฌ ูุญููููุง

#### 1. ุชุณุฑูุจ ุดุธุงูุง ุงูู span (Span Fragment Leakage)
**ุงููุดููุฉ**: ูููุน BOE ูุณุชุฎุฏู `<span>` ูุซูุฑุงู ุฏุงุฎู ุงูููุฑุงุช. ุงุณุชุฎุฑุงุฌ ุงููุต ุจู DOM traversal ูุงู ููุณู ุงูููุงู ุนูุฏ ุญุฏูุฏ ูู span.
**ุงูุญู**: ุงุณุชุฎุฏุงู `innerHTML โ text` ุนุจุฑ `_container_to_text()`:
- ูุฃุฎุฐ `decode_contents()` (innerHTML ููุต)
- ูุณุชุจุฏู `<br>` ุจู `\n`ุ ุซู ูุฒูู ุจููุฉ ุงููุณูู ุจู regex
- ูุฐุง ูุชุฌุงูู ุญุฏูุฏ ุงูู span ููุงุฆูุงู

#### 2. ุงููุคุดุฑุงุช ุจุฏูู ุดุฑุทุฉ (Markers Without Hyphen)
**ุงููุดููุฉ**: ุงููุคุดุฑุงุช ูุงูุช ุชูุณุชุฎุฑุฌ ูู "1" ุจุฏูู "-"
**ุงูุญู**: ุฏุงูุฉ `_make_marker(raw, add_hyphen=True)` ุชุถูู "-" ุฏุงุฆูุงู

#### 3. ุฑุจุท ุงููุงุฏุฉ ุงูุชุงุณุนุฉ ุนุดุฑุฉ (Article Reference Linking)
**ุงููุดููุฉ**: `parseArabicArticleNumber` ูู `ArticleReferenceText.tsx` ูุงู ูุณุชุฎุฏู `.includes("ุงูุชุงุณุนุฉ")` ูุน `break` โ ูุทุงุจู ุงููุงุฏุฉ 9 ุจุฏู 19
**ุงูุญู**:
- ูุงููุณ `arabicOrdinals` ูุน ููุงุชูุญ ูุฑุชุจุฉ ูู ุงูุฃุทูู ููุฃูุตุฑ (`arabicOrdinalKeysSorted`)
- ูุจุญุซ ุนู ุฃุทูู ูุทุงุจูุฉ ุฃููุงู โ "ุงูุชุงุณุนุฉ ุนุดุฑุฉ" (19) ูุจู "ุงูุชุงุณุนุฉ" (9)
- fallback ูุฃุฑูุงู teens
- ูู `extractNumberText`: ููุถู ุงููุทุงุจูุฉ ุงููุงููุฉ ูู ุงููุงููุณ

#### 4. ุชูุฑุงุฑ "ุงููุงุฏุฉ" ูู ุนููุงู ุงููุงุฏุฉ
**ุงููุดููุฉ**: `ExpandedArticlePanel` ูุงู ูุถูู "ุงููุงุฏุฉ" ูุจู `number_text` ุงูุฐู ูุญุชูู "ุงููุงุฏุฉ" ุฃุตูุงู
**ุงูุญู**: ูุญุต `hasAlMadda` ูุจู ุงูุฅุถุงูุฉ ูู `ArticleReferenceText.tsx`

---

### ูุดุงูู ุงูุชูุณูู ูุญููููุง

#### 5. ููุฑุฉ ุจุฏูู ูุคุดุฑ ูุง ุชุชุจุน ูุณุชูู ุงูุฃุจ (Continuation Paragraph Alignment)
**ุงููุดููุฉ**: ููุฑุฉ "ูููู ูุงุญุฏ ูู ุงููุดุชุฑููู..." (marker="", level=0) ุชุธูุฑ ุจุฃูุตู ุงููููู ุจุฏูุงู ูู ูุญุงุฐุงุฉ ุงูููุฑุฉ ุงูุฃุจ "1-"
**ุงูุญู** (ูู ููุง ุงูููููู `LawDetail.tsx` ู `ArticleReferenceText.tsx`):
```typescript
// Continuation paragraph without marker: inherit from previous
let inheritedLevel = visualLevel;
if (visualLevel === 0 && idx > 0) {
  for (let pi = idx - 1; pi >= 0; pi--) {
    if (visualParas[pi].marker) {
      inheritedLevel = visualParas[pi].visualLevel || 1;
      break;
    }
  }
}
const contIndent = inheritedLevel === 2 ? 88 : inheritedLevel >= 1 ? 58 : 0;
```

#### 6. ุฃููุงู/ุซุงููุงู ุจููุณ ูุณุชูู 1-/2- (Mixed Ordinal/Numeric Levels)
**ุงููุดููุฉ**: ุฃููุงู ูุซุงููุงู ู 1- ู 2- ูููุง ุจููุณ ุงููุณุชูู ุฑุบู ุฃููุง ูุฑููุฉ
**ุงูุญู**: ุญุณุงุจ ูุณุชูู ูุฑุฆู ุฐูู (visual level):
```typescript
const isArabicOrdinalMarker = (m) => /^(ุฃููุง|ุซุงููุง|ุซุงูุซุง|...)/.test(m);
const isNumericMarker = (m) => /^\d/.test(m);
const isLetterMarker = (m) => /^[ุฃ-ู]/.test(m);

if (hasMixedLevels && marker) {
  if (isArabicOrdinalMarker(marker)) visualLevel = 0;   // ุฃููุงู โ ูุณุชูู 0
  else if (isNumericMarker(marker)) visualLevel = 1;     // 1- โ ูุณุชูู 1
  else if (isLetterMarker(marker)) visualLevel = 2;      // ุฃ- โ ูุณุชูู 2
}
```
ููุทุจู ููุท ุนูุฏูุง ูุญุชูู ุงูููุงู ุนูู ุฎููุท ูู ุงููุคุดุฑุงุช ุงูุชุฑุชูุจูุฉ ูุงูุฑูููุฉ (`hasMixedLevels`)

#### 7. "ุฃููุงู :" ููุต ุนุงุฏู ุจุฏู ูุคุดุฑ (Ordinal Text as Plain Text)
**ุงููุดููุฉ**: ุจุนุถ ุงูููุงุฏ ุชุญุชูู "ุฃููุงู :" ููุต ุจุฏูู marker ุจูููุง "ุซุงููุงู:" ููุง marker ุตุญูุญ
**ุงูุญู**: `ordinalTextRegex` ููุดู ุงููุต ุงูุชุฑุชูุจู ููุญููู ููุคุดุฑ ุฃุซูุงุก ุงูุชุทุจูุน:
```typescript
const ordinalTextRegex = /^(ุฃููุง[ูู]?|ุซุงููุง[ูู]?|ุซุงูุซุง[ูู]?|...)\s*[:๏ผ]/;
// ุฅุฐุง ูุง ููุฌุฏ marker ููู ุงููุต ูุจุฏุฃ ุจู "ุฃููุงู :" โ ูุญููู ูู marker
if (!m && t) {
  const ordMatch = t.match(ordinalTextRegex);
  if (ordMatch) {
    m = ordMatch[0].trim();  // ุงููุคุดุฑ
    t = t.slice(...);         // ุงููุต ุจุฏูู ุงููุคุดุฑ
  }
}
```

---

### ุชูุณูู ุงููุฑุงุณูู ุงูููููุฉ (Preamble/Royal Decree)

#### 8. ุชูุณูู ุงููุฑุณูู ุงููููู (PreambleSection)
**ุงูููููู**: `PreambleSection` ูู `LawDetail.tsx`
**ุงูุญู**: ุฏุงูุฉ `classifyLine` ุชุตูู ูู ุณุทุฑ:
| ุงูุชุตููู | ุงููุซุงู | ุงูุชูุณูู |
|---------|--------|---------|
| `basmala` | ุจุณู ุงููู ุงูุฑุญูู ุงูุฑุญูู | ูุณุทุ ุนุฑูุถ |
| `decree-header` | ูุฑุณูู ูููู ุฑูู... | ูุณุทุ ุนุฑูุถุ ุฃุฎุถุฑ |
| `dignitary` | ูุญู ุณููุงู ุจู ุนุจุฏ ุงูุนุฒูุฒ | ูุณุทุ ุนุฑูุถ |
| `pronouncement` | ุฑุณููุง ุจูุง ูู ุขุช | ูุณุทุ ุนุฑูุถุ ุฃุฎุถุฑ |
| `ordinal-item` | ุฃููุงู - ุงูููุงููุฉ... | ูุคุดุฑ + ูุญุชูู |
| `signature-name` | ุณููุงู ุจู ุนุจุฏ ุงูุนุฒูุฒ | ูุณุงุฑุ ุนุฑูุถ |
| `clause` | ูุจุนุฏ ุงูุงุทูุงุน ุนูู... | ุนุงุฏู |

#### 9. regex ุฑุฃุณ ุงููุฑุณูู ูุงุณุน ุฌุฏุงู (Decree Header Regex Too Broad)
**ุงููุดููุฉ**: "ูุจุนุฏ ุงูุงุทูุงุน ุนูู ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก ุฑูู..." ููุตูู ูู decree-header
**ุงูุญู**: ูุฌุจ ุฃู ูุจุฏุฃ ุงูุณุทุฑ ุจุงููููุฉ ุงูููุชุงุญูุฉ:
```javascript
// ุฎุทุฃ: /ูุฑุณูู ูููู.*ุฑูู|ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก.*ุฑูู/
// ุตุญูุญ:
/^(ูุฑุณูู ูููู|ุฃูุฑ ูููู|ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก)\s.*ุฑูู/.test(t)
```

---

### ุงูุฌุฏุงูู (Tables)

#### 10. ุนุฑุถ ุงูุฌุฏุงูู ูุฌุฏุงูู ุญููููุฉ (ุจุฏู ูุต)
**ุงููุดููุฉ**: ุฌุฏุงูู BOE ูุงูุช ุชูุณุชุฎุฑุฌ ููุต ูุน `|` ูููุงุตู
**ุงูุญู**:
- **ุงูุงุณุชุฎุฑุงุฌ**: `_paras_from_container` ููุชุดู `<table>` ููุญูุธูุง ูู:
  ```python
  {"marker": "", "text": "", "level": 0, "type": "table", "table_rows": [["ุฎููุฉ1", "ุฎููุฉ2"], ...]}
  ```
- **ุงูุนุฑุถ**: ูู `LawDetail.tsx` ููุฑุงุช ูู ููุน `table` ุชูุนุฑุถ ูู `<table>` HTML

#### 11. ุฑููุฒ | ูู ุงููุต (Pipe Symbols in Text)
**ุงููุดููุฉ**: `_paras_from_container` ูุงู ูุณุชุฎุฏู `" | ".join(cells)` ูุฎูุงูุง ุงูุฌุฏูู
**ุงูุญู**: ุชุบููุฑ ูุงุณุชุฎุฑุงุฌ ูุฌุฏูู ููููู ุจุฏู ูุต

#### 12. ุชูุฑุงุฑ ุงููุต ูู ุงูุชุนุฏููุงุช (Amendment Text Duplication)
**ุงููุดููุฉ**: ุงูุชุนุฏูู ูุนุฑุถ ููุณ ุงููุญุชูู ูุฑุชูู โ ูุฑุฉ ููุต ููุฑุฉ ูุฌุฏูู
**ุงูุญู ุงูุฃูู**: `strip_tables=True` ูู `_container_to_text` ูุฅุฒุงูุฉ `<table>` ูู ุงููุต ุนูุฏ ุงุณุชุฎุฑุงุฌ ุงูุฌุฏุงูู ูููุตูุงู
**ุงูุญู ุงูููุงุฆู**: โ ุงูุธุฑ #13

#### 13. ูููุน ุงูุฌุฏูู ุฏุงุฎู ุงูุชุนุฏูู (Table Position in Amendment) โ ุงูุญู ุงูุฌุฐุฑู
**ุงููุดููุฉ**: ุงูุฌุฏูู ูุธูุฑ ูููุตูุงู ุนู ููุงูู ุงูุฃุตูู (ููู ุฃู ุชุญุช ุฃ- ูุจ-)
**ุงูุณุจุจ ุงูุฌุฐุฑู**: ูุตู ุงูุจูุงูุงุช ุฅูู `description` (ูุต) + `tables` (ุฌุฏุงูู ูููุตูุฉ) ูููุฏ ุงูุชุฑุชูุจ ุงูุฃุตูู
**ุงูุญู**: ูููู `content_parts` โ ูุงุฆูุฉ ูุฑุชุจุฉ ุชุญูุธ ุงููููุน ุงูุฃุตูู:

**ูู ุงูุงุณุชุฎุฑุงุฌ** (`extract_folder1_laws.py` โ `_extract_amendments`):
```python
# ุจุฏูุงู ูู description + tables ูููุตูุฉ:
# ููุณู innerHTML ุนูู ุญุฏูุฏ <table> ููุญูุธ ุงูุชุฑุชูุจ
table_split = re.split(r"(<table[\s\S]*?</table>)", raw_html, flags=re.I)
for part in table_split:
    if re.match(r"<table", part):
        content_parts.append({"type": "table", "table_rows": rows})
    else:
        content_parts.append({"type": "text", "text": cleaned_text})
amd["content_parts"] = content_parts
# + ูุญุชูุธ ุจู description (ุจุฏูู ุฌุฏุงูู) ูุงุณุชุฎุฑุงุฌ metadata
```

**ูู ุงูุนุฑุถ** (`LawDetail.tsx`):
```typescript
// ูุนุฑุถ content_parts ุจุงูุชุณูุณู
parts.map((part) => {
  if (part.type === 'table') โ <table>...</table>
  if (part.type === 'text') โ split('\n') โ render lines with markers
})
```

**ุงููุชูุฌุฉ**: ุงูุชุฑุชูุจ ูุทุงุจู ุงูุฃุตู:
1. "ุชู ุชุนุฏูู... ูุชุตุจุญ ุจุงููุต ุงูุขุชู:"
2. **ุฃ-** ูููู ูููุฑูุฒ ููุฆุฉ ุชุชุดูู ุนูู ุงููุญู ุงูุขุชู:
3. **[ุงูุฌุฏูู]** โ ูู ููุงูู ุงูุตุญูุญ
4. **ุจ-** ูุญุฏุฏ ุจูุฑุงุฑ ูู ุฑุฆูุณ ุงูููุฆุฉ...

---

### ุงูุชุนุฏููุงุช (Amendments)

#### 14. ูุต ุงูุชุนุฏูู ูุชูุฉ ูุงุญุฏุฉ (Amendment Text as One Block)
**ุงููุดููุฉ**: `get_text(strip=True)` ูุฒูู ูู ุงููุฑุงุบุงุช ูุงูุฃุณุทุฑ ุงูุฌุฏูุฏุฉ
**ุงูุญู**: ุงุณุชุฎุฏุงู `_container_to_text(hc)` ุจุฏู `hc.get_text(strip=True)` + ุฅุถุงูุฉ `whitespace-pre-wrap` ูู CSS

#### 15. `_container_to_text` โ ูุนุงูู `strip_tables`
```python
def _container_to_text(container, strip_tables=False):
    html = container.decode_contents()
    if strip_tables:
        html = re.sub(r"<table[\s\S]*?</table>", "\n", html, flags=re.I)
    # ... ุจุงูู ุงูุชุญููู
```
ููุณุชุฎุฏู ุนูุฏ ุงุณุชุฎุฑุงุฌ `description` ูู ุงูุชุนุฏููุงุช ูุชุฌูุจ ุชูุฑุงุฑ ุจูุงูุงุช ุงูุฌุฏูู

---

### ูููุงุช ุฑุฆูุณูุฉ ูุนุฏููุฉ

| ุงูููู | ุงููุธููุฉ |
|-------|---------|
| `scripts/extract_folder1_laws.py` | ุณูุฑุจุช ุงุณุชุฎุฑุงุฌ 30 ูุงููู ูู BOE |
| `client/src/pages/LawDetail.tsx` | ุตูุญุฉ ุนุฑุถ ุงููุงููู (PreambleSectionุ ููุฑุงุชุ ุฌุฏุงููุ ุชุนุฏููุงุช) |
| `client/src/components/ArticleReferenceText.tsx` | ุฑุจุท ูุฑุงุฌุน ุงูููุงุฏุ ุชุญููู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉุ ุงููุณุชููุงุช ุงููุฑุฆูุฉ |
| `client/src/components/NumberedItem.tsx` | ุนุฑุถ ููุฑุฉ ูุฑููุฉ (marker + indent) โ ูู ููุนุฏู |

### ุฃููุงุท ุงููุคุดุฑุงุช (Marker Patterns)
```
ุฃููุงู: / ุซุงููุงู: / ุซุงูุซุงู:     โ ูุณุชูู 0 (ุชุฑุชูุจู)
1- / 2- / ูฃ-                    โ ูุณุชูู 1 (ุฑููู)
ุฃ- / ุจ- / ุฌู-                   โ ูุณุชูู 2 (ุญุฑูู)
(ุจุฏูู ูุคุดุฑ)                     โ ูุฑุซ ูุณุชูู ุงูููุฑุฉ ุงูุณุงุจูุฉ
```

### ููุงุญุธุงุช ุชูููุฉ ูููุฉ
1. **ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฑุงุฌ**: ุจุนุฏ ุฃู ุชุนุฏูู ุนูู `extract_folder1_laws.py`ุ ูุฌุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑุจุช ูุงุณุชุฎุฑุงุฌ ุงูู 30 ูุงููู ูู ุฌุฏูุฏ. ุงูุณูุฑุจุช ูุญูุธ ุฃูุถุงู ูู `dist/` ุฅุฐุง ูุงู ุงููุฌูุฏ ููุฌูุฏุงู.
2. **TypeScript Errors**: ุจุนุถ ุฃุฎุทุงุก TypeScript ููุฌูุฏุฉ (ูุซู `CabinetDecisionData` ุจุฏูู `provisions`) ููููุง ูุง ุชููุน ุงูุชุดุบูู ูุฃู Vite ูุง ูุชุญูู ูู ุงูุฃููุงุน.
3. **ุงูุณูุฑูุฑ**: ูุนูู ุนูู ุงููููุฐ 3005. ุนูุฏ ุงูุชุดุบูู ูู Claudeุ ุฃุทููู ุจู `powershell -Command "Start-Process cmd -ArgumentList '/c cd /d \"path\" && npx tsx server/index.ts'"` ููุจูู ูุณุชููุงู ุนู ุงูุฌูุณุฉ.
4. **ุนูููุงุช Node**: ุฅุฐุง ูู ูุจุฏุฃ ุงูุณูุฑูุฑุ ุฃููู ุฌููุน ุนูููุงุช node ุฃููุงู: `powershell -Command "Get-Process -Name node | Stop-Process -Force"`
5. **ุงูุฃุฑูุงู ุงูููุฏูุฉ**: ุชูุณุชุฎุฏู `toHindiNumerals()` ูุชุญููู 123 โ ูกูขูฃ ูู ุงูุนุฑุถ

---

### ุงูุฃุฏูุงุช ุงููุธุงููุฉ (Legal Instruments)

ุงููุซุงุฆู ุงููุธุงููุฉ ุงูุณุนูุฏูุฉ ุตุฏุฑุช ุนูู ูุฏู 100+ ุณูุฉ ุจุฃููุงุท ูุฎุชููุฉ. **ูุง ููุฌุฏ ุชุฑุชูุจ ุซุงุจุช** ููุง ูุงุนุฏุฉ ูุงุญุฏุฉ.

#### ุฃููุงุน ุงูุฃุฏูุงุช
| ุงูููุน | ุงูุนููุงู ุงููุนุฑูุถ | ุงููุตู |
|-------|----------------|-------|
| ูุฑุณูู ูููู | ุงููุฑุณูู ุงููููู | ุฃุบูุจ ุงูุฃูุธูุฉ ุงูุญุฏูุซุฉ |
| ุฃูุฑ ูููู | ุงูุฃูุฑ ุงููููู | ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ (ุงููุธุงู ุงูุฃุณุงุณู ููุญููุ ูุฌูุณ ุงูุดูุฑู...) |
| ุฃูุฑ ุณุงูู | ุงูุฃูุฑ ุงูุณุงูู | ุฃูุธูุฉ ูุฏููุฉ |
| ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก | ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก | ูุฑุงูู ุงููุฑุณูู ุงููููู ุนุงุฏุฉุ ุฃู ูููู ูุณุชููุงู |

#### ุฃููุงุท ุงูุจูุงูุงุช ูู JSON (30 ูุธุงู BOE)
| ุงูููุท | ุงูุนุฏุฏ | ุงููุซุงู |
|-------|-------|--------|
| ูุฑุณูู ูููู + ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก | 20 | ูุธุงู ุฏุงุฑุฉ ุงูููู ุนุจุฏ ุงูุนุฒูุฒ |
| ุฃูุฑ ูููู ููุท (ุจุฏูู ูุฑุงุฑ) | 6 | ุงููุธุงู ุงูุฃุณุงุณู ููุญูู |
| ูุฑุณูู ูููู ููุท (ุจุฏูู ูุฑุงุฑ) | 3 | ูุธุงู ุงูุฅุฐุงุนุฉ ุงูุฃุณุงุณู |
| ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก ููุท (ุจุฏูู ูุฑุณูู) | 1 | ูุธุงู ุงูุฌูุณูุฉ |

#### ููู ูุนูู ุงููุดู ุงูุชููุงุฆู (`LawDetail.tsx`)
```typescript
// 1. ูููุชุดู ููุน ุงูุฃุฏุงุฉ ูู ุญูู issuing_authority
const issuingAuth = law.issuing_authority || '';
if (issuingAuth.includes('ุฃูุฑ ูููู')) โ 'ุงูุฃูุฑ ุงููููู'
if (issuingAuth.includes('ุฃูุฑ ุณุงูู')) โ 'ุงูุฃูุฑ ุงูุณุงูู'
if (issuingAuth.includes('ูุฑุณูู ูููู')) โ 'ุงููุฑุณูู ุงููููู'

// 2. ููุญุฏุฏ ุงูุชุฑุชูุจ ูู ูููุน ุงูุฃุฏุงุฉ ูู issuing_authority
//    ุฃูููุง ูุฑุฏ ุฃููุงู ูู ุงููุต ููุนุฑุถ ุฃููุงู

// 3. ุฅุฐุง ูู ููุฌุฏ ูุต ูุฃุฏุงุฉ ูุง โ ูุง ุชูุนุฑุถ (PreambleSection returns null)
```

#### ุงูุญููู ุงููุณุชุฎุฏูุฉ
| ุงูุญูู | ุงููููุน | ุงููุตู |
|-------|--------|-------|
| `issuing_authority` | ุงูุฌุฐุฑ | ูุต ูุญุชูู ูุฑุงุฌุน ุงูุฃุฏูุงุช (ูุฑุณูู ูููู ุฑูู ู/45... ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก ุฑูู 809...) |
| `royal_decree.text` | `royal_decree` | ูุต ุงููุฑุณูู/ุงูุฃูุฑ ุงููููู ุงููุงูู |
| `cabinet_decision_text` | ุงูุฌุฐุฑ | ูุต ูุฑุงุฑ ูุฌูุณ ุงููุฒุฑุงุก ุงููุงูู |
| `preamble_text` | ุงูุฌุฐุฑ | (ุบูุฑ ูุณุชุฎุฏู ุญุงููุงู ูู BOE) |

#### ุณูุฑุจุชุงุช ูุณุงุนุฏุฉ
- `scripts/extract_cabinet_decisions.py` โ ูุณุชุฎุฑุฌ ูุฑุงุฑุงุช ูุฌูุณ ุงููุฒุฑุงุก ูู BOE ููุถูููุง ููู JSON
- `scripts/check_instruments.py` โ ูุนุฑุถ ุฃููุงุน ุงูุฃุฏูุงุช ููู ูุธุงู

---

### ุงูุฅุญุงูุงุช ุจูู ุงูููุงุฏ (Article Cross-References)

#### ุงูููููู: `ArticleReferenceText.tsx`

ููุชุดู ุฅุญุงูุงุช ุงูููุงุฏ ูู ุงููุต ููุญูููุง ูุฑูุงุจุท ูุงุจูุฉ ููููุฑ.

#### ุฃููุงุท ุงูุฅุญุงูุงุช ุงููุฏุนููุฉ
```
ุงููุงุฏุฉ ุงูุฎุงูุณุฉ                    โ ุฑุงุจุท ูููุงุฏุฉ 5
ุงููุงุฏุฉ (5)                        โ ุฑุงุจุท ูููุงุฏุฉ 5
ุงููุงุฏุฉ ุงูุซุงููุฉ ุนุดุฑุฉ               โ ุฑุงุจุท ูููุงุฏุฉ 18 (ูุฑูุจ)
ุงููุงุฏุชูู ุงูุฑุงุจุนุฉ ูุงูุณุงุฏุณุฉ          โ ุฑุงุจุทุงู (4 ู 6)
ุงูููุงุฏ ุงูุซุงูุซุฉ ูุงูุฑุงุจุนุฉ ูุงูุฎุงูุณุฉ   โ ุซูุงุซุฉ ุฑูุงุจุท (3ุ 4ุ 5)
ุงููุงุฏุฉ ุงูุชุงุณุนุฉ ุฃู ุงููุงุฏุฉ ุงูุซุงููุฉ ุนุดุฑุฉ โ ุฑุงุจุทุงู ูุณุชููุงู (9 ู 18)
```

#### ููุงุนุฏ ูููุฉ
1. **ูุทุงุจูุฉ ุฏูููุฉ ููุท** โ ูุง ููุณุชุฎุฏู `.includes()` ุจู ูุทุงุจูุฉ ุงููุงููุณ ุงูุญุฑููุฉ (`arabicOrdinals[testText]`)
2. **ุจุญุซ ุชูุฏูู** โ ูุฎุชุจุฑ 1-4 ูููุงุช ูุงูุชุดุงู ุงููุฑูุจุงุช ("ุงูุซุงููุฉ ุนุดุฑุฉ")
3. **ูุญูุฒุงุช ุงูุฌูุน** โ ุงููุงุฏุชูู/ุงููุงุฏุชุงู/ุงูููุงุฏ ุชูุนูู ุจุญุซ ุงุณุชูุฑุงุฑู ุนู "ูุงูุฑุงุจุนุฉ ูุงูุณุงุฏุณุฉ"
4. **ูุง ุชุทุงุจู ุฎุงุทุฆ** โ "ุงูููุงุฏ ุงููุฐููุฑุฉ" ูุง ุชุนูู ููุงุฏ ุงููุธุงู
5. **ูุทุงู 1-721** โ ูุง ูููุจู ุฑูู ุฎุงุฑุฌ ูุฐุง ุงููุทุงู
