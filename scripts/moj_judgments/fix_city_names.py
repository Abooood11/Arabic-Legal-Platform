"""
Ø¥ØµÙ„Ø§Ø­ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù† ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
===============================================

ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ©:
1. Ø£Ø³Ù…Ø§Ø¡ Ù…Ø¯Ù† Ù…Ø´ÙˆÙ‡Ø© Ø¨Ø³Ø¨Ø¨ OCR (Ø§Ù…Ù„ØŒ Ø§Ø¬Ù„ØŒ Ø§Ø¥Ù„ØŒ Ø§Ø®Ù„...)
2. Ø£Ø³Ù…Ø§Ø¡ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "Ø±Ù‚Ù…" Ø¨Ø§Ù„Ø®Ø·Ø£
3. Ø£Ø³Ù…Ø§Ø¡ Ù…Ø¯Ù† Ù†Ø§Ù‚ØµØ©
4. Ù…Ø­Ø§ÙƒÙ… Ø¨Ø£Ù†Ù…Ø§Ø· Ù…Ø®ØªÙ„ÙØ© (Ù…Ø­ÙƒÙ…Ø© Ù…Ø­Ø§ÙØ¸Ø© X Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨X)
"""

import json
import re
import sys
from pathlib import Path

# Force UTF-8 output on Windows
sys.stdout = open(sys.stdout.fileno(), mode='w', encoding='utf-8', buffering=1)

# =============================================================================
# Ù‚Ø§Ù…ÙˆØ³ ØªØµØ­ÙŠØ­ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø´Ø§Ù…Ù„
# =============================================================================

CITY_CORRECTIONS = {
    # Ø£Ø³Ù…Ø§Ø¡ Ù…Ø´ÙˆÙ‡Ø© Ø¨Ù€ OCR (Ø­Ø±Ù Ø§Ù„Ù€ "Ø§Ù„" ÙŠØ¸Ù‡Ø± ÙƒÙ€ "Ø§Ù…Ù„" Ø£Ùˆ "Ø§Ø¬Ù„" Ø£Ùˆ "Ø§Ø¥Ù„" Ø£Ùˆ "Ø§Ø®Ù„" Ø£Ùˆ "Ø§Ø£Ù„")
    'Ø§Ù…Ù„Ø°Ù†Ø¨': 'Ø§Ù„Ù…Ø°Ù†Ø¨',
    'Ø§Ù…Ù„ÙˆÙŠÙ‡': 'Ø§Ù„Ù…ÙˆÙŠÙ‡',
    'Ø§Ù…Ù„Ø¸ÙŠÙ„Ù': 'Ø§Ù„Ù…Ø¸ÙŠÙ„Ù',
    'Ø§Ø¬Ù„Ø¨ÙŠÙ„': 'Ø§Ù„Ø¬Ø¨ÙŠÙ„',
    'Ø§Ø¬Ù„Ù…ÙˆÙ…': 'Ø§Ù„Ø¬Ù…ÙˆÙ…',
    'Ø§Ø¬Ù„ÙØ±': 'Ø§Ù„Ø¬ÙØ±',
    'Ø§Ø¥Ù„Ø­Ø³Ø§Ø¡': 'Ø§Ù„Ø£Ø­Ø³Ø§Ø¡',
    'Ø§Ø£Ù„Ø³ÙŠØ§Ø­': 'Ø§Ù„Ø£Ø³ÙŠØ§Ø­',
    'Ø§Ø®Ù„Ø±Ù…Ø©': 'Ø§Ù„Ø®Ø±Ù…Ø©',

    # Ø£Ø³Ù…Ø§Ø¡ Ù†Ø§Ù‚ØµØ© Ø¨Ø³Ø¨Ø¨ OCR (Ø­Ø±Ù Ù…ÙÙ‚ÙˆØ¯)
    'Ø±Ø¨ÙŠØ¯Ø©': 'Ø¨Ø±ÙŠØ¯Ø©',  # Ø§Ù„Ø¨Ø§Ø¡ Ø§Ø®ØªÙØª

    # Ø£Ø³Ù…Ø§Ø¡ Ø¨Ù‡Ø§ "Ø±Ù‚Ù…" Ø¨Ø§Ù„Ø®Ø·Ø£ (regex Ù„Ù… ÙŠÙ‚Ø·Ø¹ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­)
    'Ø§Ù„Ø±ÙŠØ§Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©': 'Ø§Ù„Ø±ÙŠØ§Ø¶',
    'Ø¬Ø¯Ø© Ø±Ù‚Ù…': 'Ø¬Ø¯Ø©',
    'Ø¬Ø§Ø²Ø§Ù† Ø±Ù‚Ù…': 'Ø¬Ø§Ø²Ø§Ù†',
    'Ø§Ù„Ø¯Ù…Ø§Ù… Ø±Ù‚Ù…': 'Ø§Ù„Ø¯Ù…Ø§Ù…',
    'Ù†Ø¬Ø±Ø§Ù† Ø±Ù‚Ù…': 'Ù†Ø¬Ø±Ø§Ù†',

    # Ø£Ø³Ù…Ø§Ø¡ Ø¨Ù‡Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø© ÙƒØ§Ù…Ù„Ø§Ù‹
    'Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø¬Ø¯Ø©': 'Ø¬Ø¯Ø©',

    # Ø£Ø³Ù…Ø§Ø¡ Ù…Ø´ÙˆÙ‡Ø© Ø£Ø®Ø±Ù‰
    'Ø¯Ø§Ø¦Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©': 'Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹',  # Ù…Ù† "Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©"
    'Ø£Ø­Ø¯ Ø§Ù…Ù„Ø³Ø§Ø±Ø­Ø©': 'Ø£Ø­Ø¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø­Ø©',
    'ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø±Ø³': 'ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±',
    'Ø§Ù„Ø¨ÙƒØ±ÙŠÙŠØ©': 'Ø§Ù„Ø¨ÙƒÙŠØ±ÙŠØ©',
    'Ø§Ù„Ø¹Ø±Ø¶ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„ÙŠØ©': 'Ø§Ù„Ø¹Ø±Ø¶ÙŠØ© Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©',
    'Ø§Ù„Ù†Ø§Ù…Øµ': 'Ø§Ù„Ù†Ù…Ø§Øµ',
    'Ø±Ø¬Ø§Ù„ Ø£Ù…Ù„Ø¹': 'Ø±Ø¬Ø§Ù„ Ø£Ù„Ù…Ø¹',
    'Ø­ÙˆØ·Ø© Ø¨Ù†ÙŠ Ù…ØªÙŠÙ…': 'Ø­ÙˆØ·Ø© Ø¨Ù†ÙŠ ØªÙ…ÙŠÙ…',
    'Ø¯ÙˆÙ…Ø© Ø§Ø¬Ù„Ù†Ø¯Ù„': 'Ø¯ÙˆÙ…Ø© Ø§Ù„Ø¬Ù†Ø¯Ù„',

    # Ø£Ø³Ù…Ø§Ø¡ ØµØ­ÙŠØ­Ø© (Ù„Ù„ØªØ£ÙƒÙŠØ¯)
    'Ø§Ù„Ø¹Ø§Ù…Ø±': 'Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠØ©',
    'Ø§Ù„Ø´Ø¹Ù': 'Ø§Ù„Ø´Ø¹Ù',  # Ù…Ø¯ÙŠÙ†Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© - Ù…Ø­Ø§ÙØ¸Ø© ÙÙŠ Ø§Ù„Ø¨Ø§Ø­Ø©
}

# =============================================================================
# Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
# =============================================================================

# Ù†Ù…Ø·: "Ù…Ø­ÙƒÙ…Ø© Ù…Ø­Ø§ÙØ¸Ø© X Ø§Ù„Ø¹Ø§Ù…Ø©" Ø£Ùˆ "Ù…Ø­ÙƒÙ…Ø© X Ø§Ù„Ø¹Ø§Ù…Ø©"
COURT_CITY_PATTERNS = [
    # Ù…Ø­ÙƒÙ…Ø© Ù…Ø­Ø§ÙØ¸Ø© X Ø§Ù„Ø¹Ø§Ù…Ø© / Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ©
    re.compile(r'Ù…Ø­ÙƒÙ…Ø©\s+Ù…Ø­Ø§ÙØ¸Ø©\s+(.+?)\s+(?:Ø§Ù„Ø¹Ø§Ù…Ø©|Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ©|Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©)'),
    # Ù…Ø­ÙƒÙ…Ø© X Ø§Ù„Ø¹Ø§Ù…Ø© / Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ© (Ø¨Ø¯ÙˆÙ† "Ù…Ø­Ø§ÙØ¸Ø©")
    re.compile(r'Ù…Ø­ÙƒÙ…Ø©\s+(.+?)\s+(?:Ø§Ù„Ø¹Ø§Ù…Ø©|Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ©|Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©)'),
    # Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ù€ X / Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ© Ø¨Ù€ X
    re.compile(r'(?:Ø§Ù„Ù…Ø­ÙƒÙ…Ø©|Ø§Ù…Ù„Ø­ÙƒÙ…Ø©)\s+(?:Ø§Ù„Ø¹Ø§Ù…Ø©|Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ©|Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©)\s+Ø¨(.+?)(?:\s*$|\s*[ØŒ,])'),
    # Ø¯ÙˆØ§Ø¦Ø± ... Ø¨Ù€ X
    re.compile(r'Ø¯ÙˆØ§Ø¦Ø±\s+.+?\s+Ø¨(.+?)(?:\s*$|\s*[ØŒ,])'),
]

# Ø£Ø³Ù…Ø§Ø¡ Ù…Ø¯Ù† Ù…Ø¹Ø±ÙˆÙØ© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬Ù‡Ø§ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø©
KNOWN_CITIES = [
    'Ø´Ø±ÙˆØ±Ø©', 'Ø£Ø­Ø¯ Ø±ÙÙŠØ¯Ø©', 'Ø§Ù„Ø¹ÙŠÙˆÙ†', 'Ø±ÙØ­Ø§Ø¡', 'Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø¬Ø¯Ø©', 'Ù…ÙƒØ©',
    'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', 'Ø§Ù„Ø¯Ù…Ø§Ù…', 'Ø§Ù„Ø·Ø§Ø¦Ù', 'ØªØ¨ÙˆÙƒ', 'Ø­Ø§Ø¦Ù„', 'Ø¹Ø±Ø¹Ø±',
    'Ø£Ø¨Ù‡Ø§', 'Ù†Ø¬Ø±Ø§Ù†', 'Ø¬Ø§Ø²Ø§Ù†', 'Ø§Ù„Ø¨Ø§Ø­Ø©', 'Ø§Ù„Ø£Ø­Ø³Ø§Ø¡', 'Ø§Ù„Ù‚Ø·ÙŠÙ', 'Ø§Ù„Ø®Ø¨Ø±',
    'Ø¨Ø±ÙŠØ¯Ø©', 'Ø¹Ù†ÙŠØ²Ø©', 'Ø³ÙƒØ§ÙƒØ§', 'ÙŠÙ†Ø¨Ø¹', 'Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·', 'Ø§Ù„Ø®Ø±Ø¬',
]


def extract_city_from_court_advanced(court_name: str) -> str:
    """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø¨Ø£Ù†Ù…Ø§Ø· Ù…ØªØ¹Ø¯Ø¯Ø©"""
    if not court_name:
        return ''

    # Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
    for pattern in COURT_CITY_PATTERNS:
        m = pattern.search(court_name)
        if m:
            city = m.group(1).strip()
            # ØªÙ†Ø¸ÙŠÙ
            city = re.sub(r'\s+', ' ', city)
            # ØªØµØ­ÙŠØ­ OCR
            city = city.replace('Ø±Ø´ÙˆØ±Ø©', 'Ø´Ø±ÙˆØ±Ø©')
            city = city.replace('Ø§Ø£Ù„Ø­ÙˆØ§Ù„', '')
            if city and len(city) > 1:
                return city

    # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø³Ù…Ø§Ø¡ Ù…Ø¯Ù† Ù…Ø¹Ø±ÙˆÙØ© ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø©
    for known_city in KNOWN_CITIES:
        if known_city in court_name:
            return known_city

    return ''


def fix_judgment(j: dict) -> dict:
    """Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙƒÙ… ÙˆØ§Ø­Ø¯"""
    city = j.get('city', '') or ''
    court = j.get('court_body', '') or ''

    # 1. ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØµØ­ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
    if city in CITY_CORRECTIONS:
        j['city'] = CITY_CORRECTIONS[city]
    elif not city:
        # 2. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø©
        extracted = extract_city_from_court_advanced(court)
        if extracted:
            # ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµØ­ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ø£ÙŠØ¶Ø§Ù‹
            j['city'] = CITY_CORRECTIONS.get(extracted, extracted)

    # 3. Ø¥ØµÙ„Ø§Ø­ Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø£ÙŠØ¶Ø§Ù‹ (Ø­Ø±Ù Ø§Ù„Ù€ "Ø§Ù„" Ø§Ù„Ù…Ø´ÙˆÙ‡)
    if court:
        court = court.replace('Ø­Ù…ÙƒÙ…Ø©', 'Ù…Ø­ÙƒÙ…Ø©')
        court = court.replace('Ø§Ù…Ù„Ø­ÙƒÙ…Ø©', 'Ø§Ù„Ù…Ø­ÙƒÙ…Ø©')
        court = court.replace('Ø§Ø¬Ù„Ø²Ø§Ø¦ÙŠØ©', 'Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ©')
        court = court.replace('Ø§Ø¬Ù„Ù†Ø§Ø¦ÙŠØ©', 'Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©')
        court = court.replace('Ø­Ù…Ø§ÙØ¸Ø©', 'Ù…Ø­Ø§ÙØ¸Ø©')
        court = court.replace('Ø±Ø´ÙˆØ±Ø©', 'Ø´Ø±ÙˆØ±Ø©')
        j['court_body'] = court

    # 4. Ø¥ØµÙ„Ø§Ø­ Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ù„Ù€ "Ø¯Ø§Ø¦Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©" -> "Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹"
    if 'Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹' in court and j.get('city') == 'Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹':
        j['court_body'] = 'Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹ Ø§Ù„Ø¹Ø§Ù…Ø©'

    return j


def main():
    json_path = Path(__file__).parent / 'output' / 'all_moj_judgments.json'

    print(f"ğŸ“‚ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø£Ø­ÙƒØ§Ù…: {json_path}")
    with open(json_path, 'r', encoding='utf-8') as f:
        data = json.load(f)
    print(f"   {len(data)} Ø­ÙƒÙ…")

    # Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    empty_before = sum(1 for j in data if not j.get('city'))
    print(f"\nğŸ“Š Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:")
    print(f"   Ø£Ø­ÙƒØ§Ù… Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©: {empty_before}")

    # ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª
    fixes_applied = 0
    for j in data:
        old_city = j.get('city', '')
        fix_judgment(j)
        if j.get('city', '') != old_city:
            fixes_applied += 1

    # Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    empty_after = sum(1 for j in data if not j.get('city'))
    print(f"\nâœ… Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:")
    print(f"   ØªÙ… Ø¥ØµÙ„Ø§Ø­: {fixes_applied} Ø­ÙƒÙ…")
    print(f"   Ø£Ø­ÙƒØ§Ù… Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©: {empty_after}")

    # Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
    city_counts = {}
    for j in data:
        city = j.get('city', '') or '(ÙØ§Ø±Øº)'
        city_counts[city] = city_counts.get(city, 0) + 1

    print(f"\nğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:")
    for city, count in sorted(city_counts.items(), key=lambda x: -x[1]):
        print(f"   [{count}x] {city}")

    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¯Ù† Ù…Ø´Ø¨ÙˆÙ‡Ø©
    suspicious = []
    for city in city_counts:
        if city == '(ÙØ§Ø±Øº)':
            continue
        if any(x in city for x in ['Ø±Ù‚Ù…', 'Ø§Ù„Ù…Ø­ÙƒÙ…Ø©', 'Ø§Ø¬Ù„', 'Ø§Ù…Ù„', 'Ø§Ø¥Ù„', 'Ø§Ø®Ù„', 'Ø§Ø­Ù„', 'Ø§Ø£Ù„']):
            suspicious.append(city)
    if suspicious:
        print(f"\nâš  Ù…Ø¯Ù† Ù…Ø´Ø¨ÙˆÙ‡Ø© Ù…ØªØ¨Ù‚ÙŠØ©: {suspicious}")
    else:
        print(f"\nâœ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ù† Ù…Ø´Ø¨ÙˆÙ‡Ø© Ù…ØªØ¨Ù‚ÙŠØ©")

    # Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØµØ­Ø­
    with open(json_path, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    print(f"\nğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØµØ­Ø­: {json_path}")

    # ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©
    for vol in range(1, 14):
        vol_path = Path(__file__).parent / 'output' / f'vol_{vol:02d}_judgments.json'
        if vol_path.exists():
            vol_judgments = [j for j in data if j.get('volume') == vol]
            with open(vol_path, 'w', encoding='utf-8') as f:
                json.dump(vol_judgments, f, ensure_ascii=False, indent=2)

    # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    stats = {
        'volumes_processed': 13,
        'total_judgments': len(data),
        'by_volume': {},
        'by_category': {},
        'by_city': {},
        'errors': [],
    }
    for j in data:
        vol = j.get('volume', 0)
        stats['by_volume'][str(vol)] = stats['by_volume'].get(str(vol), 0) + 1
        cat = j.get('circuit_type', 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')
        stats['by_category'][cat] = stats['by_category'].get(cat, 0) + 1
        city = j.get('city', 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
        stats['by_city'][city] = stats['by_city'].get(city, 0) + 1

    stats_path = Path(__file__).parent / 'output' / 'extraction_stats.json'
    with open(stats_path, 'w', encoding='utf-8') as f:
        json.dump(stats, f, ensure_ascii=False, indent=2)

    print("âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!")


if __name__ == '__main__':
    main()
